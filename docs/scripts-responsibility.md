# スクリプト責務設計

## 責務分離の方針

各スクリプトは単一責任の原則に従い、明確に分離された機能を持ちます。

## スクリプト一覧と責務

| スクリプト | 責務 | 処理内容 | 入力 | 出力 |
|-----------|------|----------|------|------|
| `build.sh` | イメージビルド・プッシュ | • Dockerイメージビルド<br>• ECRログイン<br>• イメージタグ付け・プッシュ | バージョンタグ | ECRプッシュ済みイメージ |
| `deploy.sh` | Blue/Greenデプロイ実行 | • ECSタスク定義登録<br>• CodeDeployデプロイ実行<br>• デプロイ完了まで監視 | バージョンタグ<br>（ECR存在前提） | デプロイ済みECSサービス |
| `dev-deploy.sh` | 統合デプロイ | • `build.sh`実行<br>• `deploy.sh`実行<br>• エラーハンドリング | バージョンタグ | 完全デプロイ実行 |

## ユースケース対応

| ユースケース | 使用スクリプト | 実行内容 | 想定ユーザー |
|-------------|---------------|----------|-------------|
| ソース修正後デプロイ | `dev-deploy.sh` | ビルド→デプロイ一括実行 | 開発者 |
| 既存イメージでデプロイ | `deploy.sh` | デプロイのみ実行 | 運用者 |
| 自動デプロイ | GitHub Actions | `build.sh`→`deploy.sh`自動実行 | CI/CD |
| イメージ作成のみ | `build.sh` | テスト用イメージ作成 | 開発者 |

## 依存関係・エラーハンドリング

| 項目 | 内容 |
|------|------|
| **依存関係** | `dev-deploy.sh` → `build.sh` + `deploy.sh`<br>`GitHub Actions` → `build.sh` + `deploy.sh` |
| **エラーハンドリング** | • `set -e`でエラー時即座終了<br>• 前提条件チェック（引数、AWS認証等）<br>• 明確なエラーメッセージ出力 |